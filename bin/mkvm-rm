#!/bin/bash

set -ueo pipefail
source "${MKVM_BIN}/lib/common"

instances=("$@")

if [ "${#instances[@]}" -eq 0 ] && [ -n "${MKVM_INSTANCE:-}" ]; then
    instances+=("${MKVM_INSTANCE}")
fi

for name in "${instances[@]}"; do
    instance_dir="$(instance_dir_of "${name}")"
    if [ ! -d "${instance_dir}" ]; then
        printf "instance not found: %s\n" "${name}" >&2
        exit 1
    fi
    run_vagrant "${name}" destroy
    rm -r "${instance_dir}"
done
